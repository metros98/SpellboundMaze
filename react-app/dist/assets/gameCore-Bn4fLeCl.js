import{s as j,p as H,a as N,b as _}from"./index-BJ-_hfz5.js";function q(n){for(let o=n.length-1;o>0;o--){const e=Math.floor(Math.random()*(o+1));[n[o],n[e]]=[n[e],n[o]]}return n}function B(n,o,e){const p=n.length,s=n[0].length,c=Array.from({length:p},()=>Array(s).fill(!1)),y=[],w=[];if(o<0||e<0||o>=s||e>=p||n[e][o]===1)return w;for(c[e][o]=!0,y.push({x:o,y:e}),w.push({x:o,y:e});y.length;){const{x,y:h}=y.shift(),t=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}];for(const r of t){const f=x+r.dx,l=h+r.dy;f>=0&&f<s&&l>=0&&l<p&&!c[l][f]&&n[l][f]===0&&(c[l][f]=!0,y.push({x:f,y:l}),w.push({x:f,y:l}))}}return w}function J(n,o){const e=n*2+1,p=o*2+1,s=Array.from({length:p},()=>Array(e).fill(1)),c=1,y=1;s[y][c]=0;const w=[{x:c,y}],x=[{dx:0,dy:-2},{dx:2,dy:0},{dx:0,dy:2},{dx:-2,dy:0}];for(;w.length;){const h=w[w.length-1],t=h.x,r=h.y,f=[];for(const l of x){const a=t+l.dx,u=r+l.dy;a>0&&a<e&&u>0&&u<p&&s[u][a]===1&&f.push({nx:a,ny:u,betweenX:t+l.dx/2,betweenY:r+l.dy/2})}if(f.length===0)w.pop();else{const l=f[Math.floor(Math.random()*f.length)];s[l.betweenY][l.betweenX]=0,s[l.ny][l.nx]=0,w.push({x:l.nx,y:l.ny})}}return s}function K(n,o){if(o<=0)return n;const e=n.length,p=n[0].length,s=[];for(let w=1;w<e-1;w++)for(let x=1;x<p-1;x++)n[w][x]===1&&s.push({x,y:w});const c=Math.floor(s.length*o);q(s);let y=0;for(const w of s){if(y>=c)break;n[w.y][w.x]=0,B(n,1,1).length<3?n[w.y][w.x]=1:y++}return n}function Q(n,o,e){const p=n.length,s=n[0].length,c=Array.from({length:p},()=>Array(s).fill(!1)),y=[];function w(h,t){const r=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}],f=[];for(const l of r){const a=h+l.dx,u=t+l.dy;a>=0&&a<s&&u>=0&&u<p&&n[u][a]===0&&f.push({x:a,y:u})}return f}const x=[{x:o,y:e,iter:0}];for(c[e][o]=!0,y.push({x:o,y:e});x.length;){const h=x[x.length-1],t=w(h.x,h.y).filter(r=>!c[r.y][r.x]);if(t.length===0)x.pop();else{const r=t[Math.floor(Math.random()*t.length)];c[r.y][r.x]=!0,x.push({x:r.x,y:r.y,iter:0}),y.push({x:r.x,y:r.y})}}return y}const X={forest:{floor:"#e8f5e9",wall:"#558b2f",border:"#a5d6a7"},ocean:{floor:"#e1f5fe",wall:"#0277bd",border:"#81d4fa"},candy:{floor:"#fce4ec",wall:"#c2185b",border:"#f8bbd0"},space:{floor:"#e8eaf6",wall:"#3949ab",border:"#9fa8da"},sunset:{floor:"#FFE4D6",wall:"#8B4A6B",border:"#FF6B4A"},castle:{floor:"#E8ECF0",wall:"#4A5568",border:"#D4AF37 "}},m={retriesDefault:1,baseCols:10,baseRows:6,mazeOpenness:.22,minLetterSpacing:3,cellSize:64,canvasWidth:800,canvasHeight:480,playerAvatar:"ðŸ™‚",mazeTheme:"forest",mazeColors:X.forest,difficulty:"easy"};let d=null,v=null,i=null,C=[],L=0,W=m.retriesDefault,b=[],g={x:0,y:0},S=[],D="",I=!1,z=!0,R=null,O=null,T=null;function V(n){if(Object.assign(m,n),n.mazeTheme&&X[n.mazeTheme]&&(m.mazeColors=X[n.mazeTheme]),n.playerAvatarUrl&&!m.playerAvatarImage){const o=new Image;o.onload=()=>{m.playerAvatarImage=o},o.src=n.playerAvatarUrl}else n.playerAvatarUrl||(m.playerAvatarImage=null)}function Z(n){C=n||[],d&&d.enableStart&&d.enableStart(!0)}function $(){return{words:C,currentWordIndex:L,attemptsLeft:W,grid:b,player:g,letterTiles:S,collected:D,running:I}}function ee(){D="",Y(C[L]||""),d&&d.updateDisplays&&d.updateDisplays({word:C[L]||"",collected:D,hideWordText:z,attemptsLeft:W})}function te(){C[L]&&j(C[L])}function ne(n){typeof n=="string"?v=document.getElementById(n):v=n,v&&(i=v.getContext("2d"),v.width=m.canvasWidth,v.height=m.canvasHeight)}function le(n={}){d=n.ui||null,n.config&&V(n.config),ne(n.canvas||n.canvasId||"gameCanvas"),R&&window.removeEventListener("keydown",R),T&&v&&v.removeEventListener("click",T),R=o=>{if(!I)return;const e=o.key;let p=0,s=0;if((e==="ArrowUp"||e==="w"||e==="W")&&(s=-1),(e==="ArrowDown"||e==="s"||e==="S")&&(s=1),(e==="ArrowLeft"||e==="a"||e==="A")&&(p=-1),(e==="ArrowRight"||e==="d"||e==="D")&&(p=1),p!==0||s!==0){const c=g.x+p,y=g.y+s;c>=0&&c<b[0].length&&y>=0&&y<b.length&&b[y][c]===0&&(g.x=c,g.y=y),o.preventDefault()}(e===" "||e==="Spacebar"||e==="Enter")&&(U(),o.preventDefault())},window.addEventListener("keydown",R),T=o=>{if(!I)return;const e=v.getBoundingClientRect(),p=v.width/e.width,s=v.height/e.height,c=(o.clientX-e.left)*p,y=(o.clientY-e.top)*s,w=b[0]?b[0].length:m.baseCols*2+1,x=b.length||m.baseRows*2+1,h=Math.max(8,Math.min(m.cellSize,Math.floor((v.width-40)/w),Math.floor((v.height-40)/x))),t=w*h,r=x*h,f=Math.floor((v.width-t)/2),l=Math.floor((v.height-r)/2);for(const a of S){const u=a.x*h+f,k=a.y*h+l;if(c>=u&&c<=u+h&&y>=k&&y<=k+h){g.x=a.x,g.y=a.y,U();return}}},v&&v.addEventListener("click",T),P()}function oe(){W=d&&d.getRetriesValue?d.getRetriesValue():m.retriesDefault,I=!0,L=0,F(),O=requestAnimationFrame(G)}function F(){if(D="",L>=C.length){d&&d.showOverlay&&d.showOverlay("All done! Great job!","success"),I=!1;return}W=d&&d.getRetriesValue?d.getRetriesValue():m.retriesDefault;const n=(C[L]||"").trim();if(!n){L++,F();return}Y(n),d&&d.updateDisplays&&d.updateDisplays({word:C[L]||"",collected:D,hideWordText:z,attemptsLeft:W}),j(n)}function re(n,o){const e="abcdefghijklmnopqrstuvwxyz",p=[];for(let s=0;s<n;s++){const c=e[Math.floor(Math.random()*e.length)];p.push(c)}return p}function Y(n){let o=J(m.baseCols,m.baseRows);if(o=K(o,m.mazeOpenness),b=o,g.x=1,g.y=1,b[g.y]&&b[g.y][g.x]===1){e:for(let t=0;t<b.length;t++)for(let r=0;r<b[0].length;r++)if(b[t][r]===0){g.x=r,g.y=t;break e}}const e=n.split("");let p=0;m.difficulty==="medium"&&(p=2),m.difficulty==="hard"&&(p=5);const s=p>0?re(p):[],c=[...e,...s];S=[],z=!0;let y=B(b,g.x,g.y).filter(t=>!(t.x===g.x&&t.y===g.y)),x=Q(b,g.x,g.y).filter(t=>!(t.x===g.x&&t.y===g.y));if(x.length<c.length&&(x=y,x.length<c.length)){for(let t=0;t<b.length&&x.length<c.length;t++)for(let r=0;r<b[0].length&&x.length<c.length;r++)b[t][r]===1&&(b[t][r]=0);x=B(b,g.x,g.y).filter(t=>!(t.x===g.x&&t.y===g.y))}const h=x.length;if(h>=c.length){const t=Math.max(0,Math.floor(m.minLetterSpacing)),r=c.length<=1||(c.length-1)*t<=h-1;if(t>0&&r){const f=[];for(let a=0;a<c.length;a++){const u=c.length-a-1,k=a===0?0:f[f.length-1]+t,M=h-1-u*t;let A=k;M>k&&(A=k+Math.floor(Math.random()*(M-k+1))),A=Math.max(0,Math.min(h-1,A)),f.push(A)}const l=new Set;for(let a=0;a<e.length;a++){let u=f[a],k=0;for(;l.has(u)&&k<h;)u=Math.min(h-1,u+1),k++;if(l.has(u)){for(let A=0;A<h;A++)if(!l.has(A)){u=A;break}}l.add(u);const M=x[u];S.push({x:M.x,y:M.y,char:e[a],isWordLetter:!0})}for(let a=0;a<s.length;a++){let u=f[e.length+a],k=0;for(;l.has(u)&&k<h;)u=Math.min(h-1,u+1),k++;if(l.has(u)){for(let A=0;A<h;A++)if(!l.has(A)){u=A;break}}l.add(u);const M=x[u];S.push({x:M.x,y:M.y,char:s[a],isWordLetter:!1})}}else{const f=Math.max(1,Math.floor(h/(c.length+1))),l=new Set;for(let a=0;a<e.length;a++){const u=(a+1)*f,k=Math.floor((Math.random()-.5)*Math.max(1,Math.floor(f/2)));let M=Math.max(0,Math.min(h-1,u+k)),A=0;for(;l.has(M)&&A<h;)M=(M+1)%h,A++;l.add(M);const E=x[M];S.push({x:E.x,y:E.y,char:e[a],isWordLetter:!0})}for(let a=0;a<s.length;a++){const u=(e.length+a+1)*f,k=Math.floor((Math.random()-.5)*Math.max(1,Math.floor(f/2)));let M=Math.max(0,Math.min(h-1,u+k)),A=0;for(;l.has(M)&&A<h;)M=(M+1)%h,A++;l.add(M);const E=x[M];S.push({x:E.x,y:E.y,char:s[a],isWordLetter:!1})}}}else{q(y);for(let t=0;t<e.length&&t<y.length;t++)S.push({x:y[t].x,y:y[t].y,char:e[t],isWordLetter:!0});for(let t=0;t<s.length&&e.length+t<y.length;t++)S.push({x:y[e.length+t].x,y:y[e.length+t].y,char:s[t],isWordLetter:!1})}}function U(){const n=S.findIndex(s=>s.x===g.x&&s.y===g.y);if(n===-1)return;const o=S[n],e=C[L]||"",p=e[D.length];if(o.char.toLowerCase()===p.toLowerCase()){if(D+=o.char,S.splice(n,1),H(880,.08),z=!1,D.length>=e.length){N(),d&&d.showOverlay&&d.showOverlay("âœ”ï¸ Great! Next word","success"),L++,z=!0,d&&d.updateDisplays&&d.updateDisplays({word:C[L]||"",collected:"",hideWordText:z,attemptsLeft:W}),setTimeout(()=>{F()},1200);return}d&&d.updateDisplays&&d.updateDisplays({word:C[L]||"",collected:D,hideWordText:z,attemptsLeft:W})}else if(W--,H(220,.18),W<=0){_(),d&&d.showOverlay&&d.showOverlay("âœ–ï¸ Out of attempts â€” moving on","fail"),L++,z=!0,d&&d.updateDisplays&&d.updateDisplays({word:C[L]||"",collected:"",hideWordText:z,attemptsLeft:W}),setTimeout(()=>{F()},1400);return}else d&&d.showOverlay&&d.showOverlay("Try again","fail"),D="",Y(C[L]||"")}function G(){P(),I&&(O=requestAnimationFrame(G))}function P(){if(!i)return;i.clearRect(0,0,v.width,v.height);const n=b[0]?b[0].length:m.baseCols*2+1,o=b.length||m.baseRows*2+1,e=Math.max(8,Math.min(m.cellSize,Math.floor((v.width-40)/n),Math.floor((v.height-40)/o))),p=n*e,s=o*e,c=Math.floor((v.width-p)/2),y=Math.floor((v.height-s)/2);for(let t=0;t<o;t++)for(let r=0;r<n;r++){const f=r*e+c,l=t*e+y;b[t]&&b[t][r]===1?(i.fillStyle=m.mazeColors.wall,i.fillRect(f,l,e-2,e-2),i.strokeStyle="rgba(0,0,0,0.3)",i.lineWidth=2,i.strokeRect(f,l,e-2,e-2),i.lineWidth=1,i.strokeStyle="rgba(255,255,255,0.2)",i.beginPath(),i.moveTo(f+1,l+e-3),i.lineTo(f+1,l+1),i.lineTo(f+e-3,l+1),i.stroke()):(i.fillStyle=m.mazeColors.floor,i.fillRect(f,l,e-2,e-2),i.strokeStyle=m.mazeColors.border,i.strokeRect(f,l,e-2,e-2))}for(const t of S){const r=t.x*e+c,f=t.y*e+y;i.fillStyle="#333",i.font="bold 28px system-ui",i.textAlign="center",i.textBaseline="middle",i.fillText(t.char.toUpperCase(),r+(e-4)/2,f+(e-4)/2)}if(S.findIndex(t=>t.x===g.x&&t.y===g.y)!==-1){const t=g.x*e+c,r=g.y*e+y;i.strokeStyle="#ffb020",i.lineWidth=3,i.strokeRect(t+4,r+4,e-8,e-8),i.lineWidth=1,i.fillStyle="rgba(255,176,32,0.12)",i.fillRect(t+4,r+4,e-8,e-8),i.fillStyle="#222",i.font="13px system-ui",i.textAlign="center",i.fillText("Press Space to pick",t+(e-4)/2,r+e-6)}const x=g.x*e+c+(e-4)/2,h=g.y*e+y+(e-4)/2;m.playerAvatarUrl&&m.playerAvatarImage?i.drawImage(m.playerAvatarImage,x-40/2,h-40/2,40,40):(i.font="32px system-ui",i.textAlign="center",i.textBaseline="middle",i.fillText(m.playerAvatar||"ðŸ™‚",x,h))}function se(){I=!1,O&&cancelAnimationFrame(O),R&&window.removeEventListener("keydown",R),R=null,T&&v&&v.removeEventListener("click",T),T=null}const ie={init:le,startGame:oe,setWords:Z,setConfig:V,getState:$,retryWord:ee,hearWord:te,stop:se};export{ie as default,$ as getState,te as hearWord,le as init,ee as retryWord,V as setConfig,Z as setWords,oe as startGame,se as stop};

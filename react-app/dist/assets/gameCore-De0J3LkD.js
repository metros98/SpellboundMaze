import{s as H,p as U,a as X,b as Y}from"./index-BmCtNp_5.js";function j(t){for(let o=t.length-1;o>0;o--){const e=Math.floor(Math.random()*(o+1));[t[o],t[e]]=[t[e],t[o]]}return t}function W(t,o,e){const x=t.length,u=t[0].length,c=Array.from({length:x},()=>Array(u).fill(!1)),s=[],n=[];if(o<0||e<0||o>=u||e>=x||t[e][o]===1)return n;for(c[e][o]=!0,s.push({x:o,y:e}),n.push({x:o,y:e});s.length;){const{x:d,y:w}=s.shift(),a=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}];for(const l of a){const f=d+l.dx,i=w+l.dy;f>=0&&f<u&&i>=0&&i<x&&!c[i][f]&&t[i][f]===0&&(c[i][f]=!0,s.push({x:f,y:i}),n.push({x:f,y:i}))}}return n}function q(t,o){const e=t*2+1,x=o*2+1,u=Array.from({length:x},()=>Array(e).fill(1)),c=1,s=1;u[s][c]=0;const n=[{x:c,y:s}],d=[{dx:0,dy:-2},{dx:2,dy:0},{dx:0,dy:2},{dx:-2,dy:0}];for(;n.length;){const w=n[n.length-1],a=w.x,l=w.y,f=[];for(const i of d){const b=a+i.dx,p=l+i.dy;b>0&&b<e&&p>0&&p<x&&u[p][b]===1&&f.push({nx:b,ny:p,betweenX:a+i.dx/2,betweenY:l+i.dy/2})}if(f.length===0)n.pop();else{const i=f[Math.floor(Math.random()*f.length)];u[i.betweenY][i.betweenX]=0,u[i.ny][i.nx]=0,n.push({x:i.nx,y:i.ny})}}return u}function G(t,o){if(o<=0)return t;const e=t.length,x=t[0].length,u=[];for(let n=1;n<e-1;n++)for(let d=1;d<x-1;d++)t[n][d]===1&&u.push({x:d,y:n});const c=Math.floor(u.length*o);j(u);let s=0;for(const n of u){if(s>=c)break;t[n.y][n.x]=0,W(t,1,1).length<3?t[n.y][n.x]=1:s++}return t}function P(t,o,e){const x=t.length,u=t[0].length,c=Array.from({length:x},()=>Array(u).fill(!1)),s=[];function n(w,a){const l=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}],f=[];for(const i of l){const b=w+i.dx,p=a+i.dy;b>=0&&b<u&&p>=0&&p<x&&t[p][b]===0&&f.push({x:b,y:p})}return f}const d=[{x:o,y:e,iter:0}];for(c[e][o]=!0,s.push({x:o,y:e});d.length;){const w=d[d.length-1],a=n(w.x,w.y).filter(l=>!c[l.y][l.x]);if(a.length===0)d.pop();else{const l=a[Math.floor(Math.random()*a.length)];c[l.y][l.x]=!0,d.push({x:l.x,y:l.y,iter:0}),s.push({x:l.x,y:l.y})}}return s}const L={forest:{floor:"#e8f5e9",wall:"#558b2f",border:"#a5d6a7"},ocean:{floor:"#e1f5fe",wall:"#0277bd",border:"#81d4fa"},candy:{floor:"#fce4ec",wall:"#c2185b",border:"#f8bbd0"},space:{floor:"#e8eaf6",wall:"#3949ab",border:"#9fa8da"}},g={retriesDefault:1,baseCols:10,baseRows:6,mazeOpenness:.22,minLetterSpacing:3,cellSize:64,canvasWidth:800,canvasHeight:480,playerAvatar:"ðŸ™‚",mazeTheme:"forest",mazeColors:L.forest};let r=null,A=null,y=null,M=[],v=0,S=g.retriesDefault,m=[],h={x:0,y:0},D=[],C="",I=!1,k=!0,z=null,R=null;function B(t){if(Object.assign(g,t),t.mazeTheme&&L[t.mazeTheme]&&(g.mazeColors=L[t.mazeTheme]),t.playerAvatarUrl&&!g.playerAvatarImage){const o=new Image;o.onload=()=>{g.playerAvatarImage=o},o.src=t.playerAvatarUrl}else t.playerAvatarUrl||(g.playerAvatarImage=null)}function N(t){M=t||[],r&&r.enableStart&&r.enableStart(!0)}function _(){return{words:M,currentWordIndex:v,attemptsLeft:S,grid:m,player:h,letterTiles:D,collected:C,running:I}}function J(){C="",O(M[v]||""),r&&r.updateDisplays&&r.updateDisplays({word:M[v]||"",collected:C,hideWordText:k,attemptsLeft:S})}function K(){M[v]&&H(M[v])}function Q(t){typeof t=="string"?A=document.getElementById(t):A=t,A&&(y=A.getContext("2d"),A.width=g.canvasWidth,A.height=g.canvasHeight)}function Z(t={}){r=t.ui||null,t.config&&B(t.config),Q(t.canvas||t.canvasId||"gameCanvas"),z&&window.removeEventListener("keydown",z),z=o=>{if(!I)return;const e=o.key;let x=0,u=0;if((e==="ArrowUp"||e==="w"||e==="W")&&(u=-1),(e==="ArrowDown"||e==="s"||e==="S")&&(u=1),(e==="ArrowLeft"||e==="a"||e==="A")&&(x=-1),(e==="ArrowRight"||e==="d"||e==="D")&&(x=1),x!==0||u!==0){const c=h.x+x,s=h.y+u;c>=0&&c<m[0].length&&s>=0&&s<m.length&&m[s][c]===0&&(h.x=c,h.y=s),o.preventDefault()}(e===" "||e==="Spacebar"||e==="Enter")&&(ee(),o.preventDefault())},window.addEventListener("keydown",z),V()}function $(){S=r&&r.getRetriesValue?r.getRetriesValue():g.retriesDefault,I=!0,v=0,T(),R=requestAnimationFrame(F)}function T(){if(C="",v>=M.length){r&&r.showOverlay&&r.showOverlay("All done! Great job!","success"),I=!1;return}S=r&&r.getRetriesValue?r.getRetriesValue():g.retriesDefault;const t=(M[v]||"").trim();if(!t){v++,T();return}O(t),r&&r.updateDisplays&&r.updateDisplays({word:M[v]||"",collected:C,hideWordText:k,attemptsLeft:S}),H(t)}function O(t){let o=q(g.baseCols,g.baseRows);if(o=G(o,g.mazeOpenness),m=o,h.x=1,h.y=1,m[h.y]&&m[h.y][h.x]===1){e:for(let n=0;n<m.length;n++)for(let d=0;d<m[0].length;d++)if(m[n][d]===0){h.x=d,h.y=n;break e}}const e=t.split("");D=[],k=!0;let x=W(m,h.x,h.y).filter(n=>!(n.x===h.x&&n.y===h.y)),c=P(m,h.x,h.y).filter(n=>!(n.x===h.x&&n.y===h.y));if(c.length<e.length&&(c=x,c.length<e.length)){for(let n=0;n<m.length&&c.length<e.length;n++)for(let d=0;d<m[0].length&&c.length<e.length;d++)m[n][d]===1&&(m[n][d]=0);c=W(m,h.x,h.y).filter(n=>!(n.x===h.x&&n.y===h.y))}const s=c.length;if(s>=e.length){const n=Math.max(0,Math.floor(g.minLetterSpacing)),d=e.length<=1||(e.length-1)*n<=s-1;if(n>0&&d){const w=[];for(let l=0;l<e.length;l++){const f=e.length-l-1,i=l===0?0:w[w.length-1]+n,b=s-1-f*n;let p=i;b>i&&(p=i+Math.floor(Math.random()*(b-i+1))),p=Math.max(0,Math.min(s-1,p)),w.push(p)}const a=new Set;for(let l=0;l<w.length;l++){let f=w[l],i=0;for(;a.has(f)&&i<s;)f=Math.min(s-1,f+1),i++;if(a.has(f)){for(let p=0;p<s;p++)if(!a.has(p)){f=p;break}}a.add(f);const b=c[f];D.push({x:b.x,y:b.y,char:e[l]})}}else{const w=Math.max(1,Math.floor(s/(e.length+1))),a=new Set;for(let l=0;l<e.length;l++){const f=(l+1)*w,i=Math.floor((Math.random()-.5)*Math.max(1,Math.floor(w/2)));let b=Math.max(0,Math.min(s-1,f+i)),p=0;for(;a.has(b)&&p<s;)b=(b+1)%s,p++;a.add(b);const E=c[b];D.push({x:E.x,y:E.y,char:e[l]})}}}else{j(x);for(let n=0;n<e.length&&n<x.length;n++)D.push({x:x[n].x,y:x[n].y,char:e[n]})}}function ee(){const t=D.findIndex(u=>u.x===h.x&&u.y===h.y);if(t===-1)return;const o=D[t],e=M[v]||"",x=e[C.length];if(o.char.toLowerCase()===x.toLowerCase()){if(C+=o.char,D.splice(t,1),U(880,.08),k=!1,C.length>=e.length){X(),r&&r.showOverlay&&r.showOverlay("âœ”ï¸ Great! Next word","success"),v++,k=!0,r&&r.updateDisplays&&r.updateDisplays({word:M[v]||"",collected:"",hideWordText:k,attemptsLeft:S}),setTimeout(()=>{T()},1200);return}r&&r.updateDisplays&&r.updateDisplays({word:M[v]||"",collected:C,hideWordText:k,attemptsLeft:S})}else if(S--,U(220,.18),S<=0){Y(),r&&r.showOverlay&&r.showOverlay("âœ–ï¸ Out of attempts â€” moving on","fail"),v++,k=!0,r&&r.updateDisplays&&r.updateDisplays({word:M[v]||"",collected:"",hideWordText:k,attemptsLeft:S}),setTimeout(()=>{T()},1400);return}else r&&r.showOverlay&&r.showOverlay("Try again","fail"),C="",O(M[v]||"")}function F(){V(),I&&(R=requestAnimationFrame(F))}function V(){if(!y)return;y.clearRect(0,0,A.width,A.height);const t=m[0]?m[0].length:g.baseCols*2+1,o=m.length||g.baseRows*2+1,e=Math.max(8,Math.min(g.cellSize,Math.floor((A.width-40)/t),Math.floor((A.height-40)/o))),x=t*e,u=o*e,c=Math.floor((A.width-x)/2),s=Math.floor((A.height-u)/2);for(let a=0;a<o;a++)for(let l=0;l<t;l++){const f=l*e+c,i=a*e+s;y.fillStyle=g.mazeColors.floor,y.fillRect(f,i,e-4,e-4),m[a]&&m[a][l]===1&&(y.fillStyle=g.mazeColors.wall,y.fillRect(f+6,i+6,e-16,e-16)),y.strokeStyle=g.mazeColors.border,y.strokeRect(f,i,e-4,e-4)}for(const a of D){const l=a.x*e+c,f=a.y*e+s;y.fillStyle="#333",y.font="bold 28px system-ui",y.textAlign="center",y.textBaseline="middle",y.fillText(a.char.toUpperCase(),l+(e-4)/2,f+(e-4)/2)}if(D.findIndex(a=>a.x===h.x&&a.y===h.y)!==-1){const a=h.x*e+c,l=h.y*e+s;y.strokeStyle="#ffb020",y.lineWidth=3,y.strokeRect(a+4,l+4,e-8,e-8),y.lineWidth=1,y.fillStyle="rgba(255,176,32,0.12)",y.fillRect(a+4,l+4,e-8,e-8),y.fillStyle="#222",y.font="13px system-ui",y.textAlign="center",y.fillText("Press Space to pick",a+(e-4)/2,l+e-6)}const d=h.x*e+c+(e-4)/2,w=h.y*e+s+(e-4)/2;g.playerAvatarUrl&&g.playerAvatarImage?y.drawImage(g.playerAvatarImage,d-40/2,w-40/2,40,40):(y.font="32px system-ui",y.textAlign="center",y.textBaseline="middle",y.fillText(g.playerAvatar||"ðŸ™‚",d,w))}function te(){I=!1,R&&cancelAnimationFrame(R),z&&window.removeEventListener("keydown",z),z=null}const le={init:Z,startGame:$,setWords:N,setConfig:B,getState:_,retryWord:J,hearWord:K,stop:te};export{le as default,_ as getState,K as hearWord,Z as init,J as retryWord,B as setConfig,N as setWords,$ as startGame,te as stop};

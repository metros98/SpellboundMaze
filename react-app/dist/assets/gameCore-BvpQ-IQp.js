import{s as U,p as Y,a as q,b as G}from"./index-CN_Y93q1.js";function B(t){for(let o=t.length-1;o>0;o--){const e=Math.floor(Math.random()*(o+1));[t[o],t[e]]=[t[e],t[o]]}return t}function W(t,o,e){const p=t.length,u=t[0].length,f=Array.from({length:p},()=>Array(u).fill(!1)),s=[],n=[];if(o<0||e<0||o>=u||e>=p||t[e][o]===1)return n;for(f[e][o]=!0,s.push({x:o,y:e}),n.push({x:o,y:e});s.length;){const{x:d,y:g}=s.shift(),i=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}];for(const l of i){const r=d+l.dx,a=g+l.dy;r>=0&&r<u&&a>=0&&a<p&&!f[a][r]&&t[a][r]===0&&(f[a][r]=!0,s.push({x:r,y:a}),n.push({x:r,y:a}))}}return n}function N(t,o){const e=t*2+1,p=o*2+1,u=Array.from({length:p},()=>Array(e).fill(1)),f=1,s=1;u[s][f]=0;const n=[{x:f,y:s}],d=[{dx:0,dy:-2},{dx:2,dy:0},{dx:0,dy:2},{dx:-2,dy:0}];for(;n.length;){const g=n[n.length-1],i=g.x,l=g.y,r=[];for(const a of d){const m=i+a.dx,v=l+a.dy;m>0&&m<e&&v>0&&v<p&&u[v][m]===1&&r.push({nx:m,ny:v,betweenX:i+a.dx/2,betweenY:l+a.dy/2})}if(r.length===0)n.pop();else{const a=r[Math.floor(Math.random()*r.length)];u[a.betweenY][a.betweenX]=0,u[a.ny][a.nx]=0,n.push({x:a.nx,y:a.ny})}}return u}function P(t,o){if(o<=0)return t;const e=t.length,p=t[0].length,u=[];for(let n=1;n<e-1;n++)for(let d=1;d<p-1;d++)t[n][d]===1&&u.push({x:d,y:n});const f=Math.floor(u.length*o);B(u);let s=0;for(const n of u){if(s>=f)break;t[n.y][n.x]=0,W(t,1,1).length<3?t[n.y][n.x]=1:s++}return t}function _(t,o,e){const p=t.length,u=t[0].length,f=Array.from({length:p},()=>Array(u).fill(!1)),s=[];function n(g,i){const l=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}],r=[];for(const a of l){const m=g+a.dx,v=i+a.dy;m>=0&&m<u&&v>=0&&v<p&&t[v][m]===0&&r.push({x:m,y:v})}return r}const d=[{x:o,y:e,iter:0}];for(f[e][o]=!0,s.push({x:o,y:e});d.length;){const g=d[d.length-1],i=n(g.x,g.y).filter(l=>!f[l.y][l.x]);if(i.length===0)d.pop();else{const l=i[Math.floor(Math.random()*i.length)];f[l.y][l.x]=!0,d.push({x:l.x,y:l.y,iter:0}),s.push({x:l.x,y:l.y})}}return s}const O={forest:{floor:"#e8f5e9",wall:"#558b2f",border:"#a5d6a7"},ocean:{floor:"#e1f5fe",wall:"#0277bd",border:"#81d4fa"},candy:{floor:"#fce4ec",wall:"#c2185b",border:"#f8bbd0"},space:{floor:"#e8eaf6",wall:"#3949ab",border:"#9fa8da"}},y={retriesDefault:1,baseCols:10,baseRows:6,mazeOpenness:.22,minLetterSpacing:3,cellSize:64,canvasWidth:800,canvasHeight:480,playerAvatar:"ðŸ™‚",mazeTheme:"forest",mazeColors:O.forest};let c=null,b=null,x=null,k=[],M=0,C=y.retriesDefault,w=[],h={x:0,y:0},A=[],S="",I=!1,D=!0,z=null,T=null,R=null;function j(t){if(Object.assign(y,t),t.mazeTheme&&O[t.mazeTheme]&&(y.mazeColors=O[t.mazeTheme]),t.playerAvatarUrl&&!y.playerAvatarImage){const o=new Image;o.onload=()=>{y.playerAvatarImage=o},o.src=t.playerAvatarUrl}else t.playerAvatarUrl||(y.playerAvatarImage=null)}function J(t){k=t||[],c&&c.enableStart&&c.enableStart(!0)}function K(){return{words:k,currentWordIndex:M,attemptsLeft:C,grid:w,player:h,letterTiles:A,collected:S,running:I}}function Q(){S="",E(k[M]||""),c&&c.updateDisplays&&c.updateDisplays({word:k[M]||"",collected:S,hideWordText:D,attemptsLeft:C})}function Z(){k[M]&&U(k[M])}function $(t){typeof t=="string"?b=document.getElementById(t):b=t,b&&(x=b.getContext("2d"),b.width=y.canvasWidth,b.height=y.canvasHeight)}function ee(t={}){c=t.ui||null,t.config&&j(t.config),$(t.canvas||t.canvasId||"gameCanvas"),z&&window.removeEventListener("keydown",z),R&&b&&b.removeEventListener("click",R),z=o=>{if(!I)return;const e=o.key;let p=0,u=0;if((e==="ArrowUp"||e==="w"||e==="W")&&(u=-1),(e==="ArrowDown"||e==="s"||e==="S")&&(u=1),(e==="ArrowLeft"||e==="a"||e==="A")&&(p=-1),(e==="ArrowRight"||e==="d"||e==="D")&&(p=1),p!==0||u!==0){const f=h.x+p,s=h.y+u;f>=0&&f<w[0].length&&s>=0&&s<w.length&&w[s][f]===0&&(h.x=f,h.y=s),o.preventDefault()}(e===" "||e==="Spacebar"||e==="Enter")&&(H(),o.preventDefault())},window.addEventListener("keydown",z),R=o=>{if(!I){console.log("Click ignored - game not running");return}const e=b.getBoundingClientRect(),p=b.width/e.width,u=b.height/e.height,f=(o.clientX-e.left)*p,s=(o.clientY-e.top)*u;console.log("Click detected:",{clickX:f,clickY:s,letterTiles:A.length});const n=w[0]?.length||y.baseCols,d=w.length||y.baseRows,g=y.cellSize,i=(y.canvasWidth-n*g)/2,l=(y.canvasHeight-d*g)/2;for(const r of A){const a=r.x*g+i,m=r.y*g+l;if(console.log("Checking tile:",{char:r.char,gx:a,gy:m,cs:g}),f>=a&&f<=a+g&&s>=m&&s<=m+g){console.log("Clicked on letter:",r.char),h.x=r.x,h.y=r.y,H();return}}console.log("No letter tile clicked")},b&&b.addEventListener("click",R),V()}function te(){C=c&&c.getRetriesValue?c.getRetriesValue():y.retriesDefault,I=!0,M=0,L(),T=requestAnimationFrame(F)}function L(){if(S="",M>=k.length){c&&c.showOverlay&&c.showOverlay("All done! Great job!","success"),I=!1;return}C=c&&c.getRetriesValue?c.getRetriesValue():y.retriesDefault;const t=(k[M]||"").trim();if(!t){M++,L();return}E(t),c&&c.updateDisplays&&c.updateDisplays({word:k[M]||"",collected:S,hideWordText:D,attemptsLeft:C}),U(t)}function E(t){let o=N(y.baseCols,y.baseRows);if(o=P(o,y.mazeOpenness),w=o,h.x=1,h.y=1,w[h.y]&&w[h.y][h.x]===1){e:for(let n=0;n<w.length;n++)for(let d=0;d<w[0].length;d++)if(w[n][d]===0){h.x=d,h.y=n;break e}}const e=t.split("");A=[],D=!0;let p=W(w,h.x,h.y).filter(n=>!(n.x===h.x&&n.y===h.y)),f=_(w,h.x,h.y).filter(n=>!(n.x===h.x&&n.y===h.y));if(f.length<e.length&&(f=p,f.length<e.length)){for(let n=0;n<w.length&&f.length<e.length;n++)for(let d=0;d<w[0].length&&f.length<e.length;d++)w[n][d]===1&&(w[n][d]=0);f=W(w,h.x,h.y).filter(n=>!(n.x===h.x&&n.y===h.y))}const s=f.length;if(s>=e.length){const n=Math.max(0,Math.floor(y.minLetterSpacing)),d=e.length<=1||(e.length-1)*n<=s-1;if(n>0&&d){const g=[];for(let l=0;l<e.length;l++){const r=e.length-l-1,a=l===0?0:g[g.length-1]+n,m=s-1-r*n;let v=a;m>a&&(v=a+Math.floor(Math.random()*(m-a+1))),v=Math.max(0,Math.min(s-1,v)),g.push(v)}const i=new Set;for(let l=0;l<g.length;l++){let r=g[l],a=0;for(;i.has(r)&&a<s;)r=Math.min(s-1,r+1),a++;if(i.has(r)){for(let v=0;v<s;v++)if(!i.has(v)){r=v;break}}i.add(r);const m=f[r];A.push({x:m.x,y:m.y,char:e[l]})}}else{const g=Math.max(1,Math.floor(s/(e.length+1))),i=new Set;for(let l=0;l<e.length;l++){const r=(l+1)*g,a=Math.floor((Math.random()-.5)*Math.max(1,Math.floor(g/2)));let m=Math.max(0,Math.min(s-1,r+a)),v=0;for(;i.has(m)&&v<s;)m=(m+1)%s,v++;i.add(m);const X=f[m];A.push({x:X.x,y:X.y,char:e[l]})}}}else{B(p);for(let n=0;n<e.length&&n<p.length;n++)A.push({x:p[n].x,y:p[n].y,char:e[n]})}}function H(){const t=A.findIndex(u=>u.x===h.x&&u.y===h.y);if(t===-1)return;const o=A[t],e=k[M]||"",p=e[S.length];if(o.char.toLowerCase()===p.toLowerCase()){if(S+=o.char,A.splice(t,1),Y(880,.08),D=!1,S.length>=e.length){q(),c&&c.showOverlay&&c.showOverlay("âœ”ï¸ Great! Next word","success"),M++,D=!0,c&&c.updateDisplays&&c.updateDisplays({word:k[M]||"",collected:"",hideWordText:D,attemptsLeft:C}),setTimeout(()=>{L()},1200);return}c&&c.updateDisplays&&c.updateDisplays({word:k[M]||"",collected:S,hideWordText:D,attemptsLeft:C})}else if(C--,Y(220,.18),C<=0){G(),c&&c.showOverlay&&c.showOverlay("âœ–ï¸ Out of attempts â€” moving on","fail"),M++,D=!0,c&&c.updateDisplays&&c.updateDisplays({word:k[M]||"",collected:"",hideWordText:D,attemptsLeft:C}),setTimeout(()=>{L()},1400);return}else c&&c.showOverlay&&c.showOverlay("Try again","fail"),S="",E(k[M]||"")}function F(){V(),I&&(T=requestAnimationFrame(F))}function V(){if(!x)return;x.clearRect(0,0,b.width,b.height);const t=w[0]?w[0].length:y.baseCols*2+1,o=w.length||y.baseRows*2+1,e=Math.max(8,Math.min(y.cellSize,Math.floor((b.width-40)/t),Math.floor((b.height-40)/o))),p=t*e,u=o*e,f=Math.floor((b.width-p)/2),s=Math.floor((b.height-u)/2);for(let i=0;i<o;i++)for(let l=0;l<t;l++){const r=l*e+f,a=i*e+s;x.fillStyle=y.mazeColors.floor,x.fillRect(r,a,e-4,e-4),w[i]&&w[i][l]===1&&(x.fillStyle=y.mazeColors.wall,x.fillRect(r+6,a+6,e-16,e-16)),x.strokeStyle=y.mazeColors.border,x.strokeRect(r,a,e-4,e-4)}for(const i of A){const l=i.x*e+f,r=i.y*e+s;x.fillStyle="#333",x.font="bold 28px system-ui",x.textAlign="center",x.textBaseline="middle",x.fillText(i.char.toUpperCase(),l+(e-4)/2,r+(e-4)/2)}if(A.findIndex(i=>i.x===h.x&&i.y===h.y)!==-1){const i=h.x*e+f,l=h.y*e+s;x.strokeStyle="#ffb020",x.lineWidth=3,x.strokeRect(i+4,l+4,e-8,e-8),x.lineWidth=1,x.fillStyle="rgba(255,176,32,0.12)",x.fillRect(i+4,l+4,e-8,e-8),x.fillStyle="#222",x.font="13px system-ui",x.textAlign="center",x.fillText("Press Space to pick",i+(e-4)/2,l+e-6)}const d=h.x*e+f+(e-4)/2,g=h.y*e+s+(e-4)/2;y.playerAvatarUrl&&y.playerAvatarImage?x.drawImage(y.playerAvatarImage,d-40/2,g-40/2,40,40):(x.font="32px system-ui",x.textAlign="center",x.textBaseline="middle",x.fillText(y.playerAvatar||"ðŸ™‚",d,g))}function ne(){I=!1,T&&cancelAnimationFrame(T),z&&window.removeEventListener("keydown",z),z=null,R&&b&&b.removeEventListener("click",R),R=null}const oe={init:ee,startGame:te,setWords:J,setConfig:j,getState:K,retryWord:Q,hearWord:Z,stop:ne};export{oe as default,K as getState,Z as hearWord,ee as init,Q as retryWord,j as setConfig,J as setWords,te as startGame,ne as stop};

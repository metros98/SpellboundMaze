import{s as q,p as j,a as N,b as _}from"./index-CCWdG8oS.js";function F(n){for(let l=n.length-1;l>0;l--){const e=Math.floor(Math.random()*(l+1));[n[l],n[e]]=[n[e],n[l]]}return n}function Y(n,l,e){const m=n.length,s=n[0].length,i=Array.from({length:m},()=>Array(s).fill(!1)),h=[],w=[];if(l<0||e<0||l>=s||e>=m||n[e][l]===1)return w;for(i[e][l]=!0,h.push({x:l,y:e}),w.push({x:l,y:e});h.length;){const{x,y:c}=h.shift(),t=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}];for(const o of t){const d=x+o.dx,r=c+o.dy;d>=0&&d<s&&r>=0&&r<m&&!i[r][d]&&n[r][d]===0&&(i[r][d]=!0,h.push({x:d,y:r}),w.push({x:d,y:r}))}}return w}function J(n,l){const e=n*2+1,m=l*2+1,s=Array.from({length:m},()=>Array(e).fill(1)),i=1,h=1;s[h][i]=0;const w=[{x:i,y:h}],x=[{dx:0,dy:-2},{dx:2,dy:0},{dx:0,dy:2},{dx:-2,dy:0}];for(;w.length;){const c=w[w.length-1],t=c.x,o=c.y,d=[];for(const r of x){const a=t+r.dx,y=o+r.dy;a>0&&a<e&&y>0&&y<m&&s[y][a]===1&&d.push({nx:a,ny:y,betweenX:t+r.dx/2,betweenY:o+r.dy/2})}if(d.length===0)w.pop();else{const r=d[Math.floor(Math.random()*d.length)];s[r.betweenY][r.betweenX]=0,s[r.ny][r.nx]=0,w.push({x:r.nx,y:r.ny})}}return s}function K(n,l){if(l<=0)return n;const e=n.length,m=n[0].length,s=[];for(let w=1;w<e-1;w++)for(let x=1;x<m-1;x++)n[w][x]===1&&s.push({x,y:w});const i=Math.floor(s.length*l);F(s);let h=0;for(const w of s){if(h>=i)break;n[w.y][w.x]=0,Y(n,1,1).length<3?n[w.y][w.x]=1:h++}return n}function Q(n,l,e){const m=n.length,s=n[0].length,i=Array.from({length:m},()=>Array(s).fill(!1)),h=[];function w(c,t){const o=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}],d=[];for(const r of o){const a=c+r.dx,y=t+r.dy;a>=0&&a<s&&y>=0&&y<m&&n[y][a]===0&&d.push({x:a,y})}return d}const x=[{x:l,y:e,iter:0}];for(i[e][l]=!0,h.push({x:l,y:e});x.length;){const c=x[x.length-1],t=w(c.x,c.y).filter(o=>!i[o.y][o.x]);if(t.length===0)x.pop();else{const o=t[Math.floor(Math.random()*t.length)];i[o.y][o.x]=!0,x.push({x:o.x,y:o.y,iter:0}),h.push({x:o.x,y:o.y})}}return h}const H={forest:{floor:"#e8f5e9",wall:"#558b2f",border:"#a5d6a7"},ocean:{floor:"#e1f5fe",wall:"#0277bd",border:"#81d4fa"},candy:{floor:"#fce4ec",wall:"#c2185b",border:"#f8bbd0"},space:{floor:"#e8eaf6",wall:"#3949ab",border:"#9fa8da"}},g={retriesDefault:1,baseCols:10,baseRows:6,mazeOpenness:.22,minLetterSpacing:3,cellSize:64,canvasWidth:800,canvasHeight:480,playerAvatar:"ðŸ™‚",mazeTheme:"forest",mazeColors:H.forest,difficulty:"easy"};let f=null,v=null,p=null,S=[],L=0,z=g.retriesDefault,b=[],u={x:0,y:0},C=[],W="",T=!1,D=!0,R=null,E=null,I=null;function V(n){if(Object.assign(g,n),n.mazeTheme&&H[n.mazeTheme]&&(g.mazeColors=H[n.mazeTheme]),n.playerAvatarUrl&&!g.playerAvatarImage){const l=new Image;l.onload=()=>{g.playerAvatarImage=l},l.src=n.playerAvatarUrl}else n.playerAvatarUrl||(g.playerAvatarImage=null)}function Z(n){S=n||[],f&&f.enableStart&&f.enableStart(!0)}function $(){return{words:S,currentWordIndex:L,attemptsLeft:z,grid:b,player:u,letterTiles:C,collected:W,running:T}}function ee(){W="",U(S[L]||""),f&&f.updateDisplays&&f.updateDisplays({word:S[L]||"",collected:W,hideWordText:D,attemptsLeft:z})}function te(){S[L]&&q(S[L])}function ne(n){typeof n=="string"?v=document.getElementById(n):v=n,v&&(p=v.getContext("2d"),v.width=g.canvasWidth,v.height=g.canvasHeight)}function le(n={}){f=n.ui||null,n.config&&V(n.config),ne(n.canvas||n.canvasId||"gameCanvas"),R&&window.removeEventListener("keydown",R),I&&v&&v.removeEventListener("click",I),R=l=>{if(!T)return;const e=l.key;let m=0,s=0;if((e==="ArrowUp"||e==="w"||e==="W")&&(s=-1),(e==="ArrowDown"||e==="s"||e==="S")&&(s=1),(e==="ArrowLeft"||e==="a"||e==="A")&&(m=-1),(e==="ArrowRight"||e==="d"||e==="D")&&(m=1),m!==0||s!==0){const i=u.x+m,h=u.y+s;i>=0&&i<b[0].length&&h>=0&&h<b.length&&b[h][i]===0&&(u.x=i,u.y=h),l.preventDefault()}(e===" "||e==="Spacebar"||e==="Enter")&&(B(),l.preventDefault())},window.addEventListener("keydown",R),I=l=>{if(!T)return;const e=v.getBoundingClientRect(),m=v.width/e.width,s=v.height/e.height,i=(l.clientX-e.left)*m,h=(l.clientY-e.top)*s,w=b[0]?b[0].length:g.baseCols*2+1,x=b.length||g.baseRows*2+1,c=Math.max(8,Math.min(g.cellSize,Math.floor((v.width-40)/w),Math.floor((v.height-40)/x))),t=w*c,o=x*c,d=Math.floor((v.width-t)/2),r=Math.floor((v.height-o)/2);for(const a of C){const y=a.x*c+d,k=a.y*c+r;if(i>=y&&i<=y+c&&h>=k&&h<=k+c){u.x=a.x,u.y=a.y,B();return}}},v&&v.addEventListener("click",I),P()}function oe(){z=f&&f.getRetriesValue?f.getRetriesValue():g.retriesDefault,T=!0,L=0,X(),E=requestAnimationFrame(G)}function X(){if(W="",L>=S.length){f&&f.showOverlay&&f.showOverlay("All done! Great job!","success"),T=!1;return}z=f&&f.getRetriesValue?f.getRetriesValue():g.retriesDefault;const n=(S[L]||"").trim();if(!n){L++,X();return}U(n),f&&f.updateDisplays&&f.updateDisplays({word:S[L]||"",collected:W,hideWordText:D,attemptsLeft:z}),q(n)}function re(n,l){const e="abcdefghijklmnopqrstuvwxyz",m=[];for(let s=0;s<n;s++){const i=e[Math.floor(Math.random()*e.length)];m.push(i)}return m}function U(n){let l=J(g.baseCols,g.baseRows);if(l=K(l,g.mazeOpenness),b=l,u.x=1,u.y=1,b[u.y]&&b[u.y][u.x]===1){e:for(let t=0;t<b.length;t++)for(let o=0;o<b[0].length;o++)if(b[t][o]===0){u.x=o,u.y=t;break e}}const e=n.split("");let m=0;g.difficulty==="medium"&&(m=2),g.difficulty==="hard"&&(m=5);const s=m>0?re(m):[],i=[...e,...s];C=[],D=!0;let h=Y(b,u.x,u.y).filter(t=>!(t.x===u.x&&t.y===u.y)),x=Q(b,u.x,u.y).filter(t=>!(t.x===u.x&&t.y===u.y));if(x.length<i.length&&(x=h,x.length<i.length)){for(let t=0;t<b.length&&x.length<i.length;t++)for(let o=0;o<b[0].length&&x.length<i.length;o++)b[t][o]===1&&(b[t][o]=0);x=Y(b,u.x,u.y).filter(t=>!(t.x===u.x&&t.y===u.y))}const c=x.length;if(c>=i.length){const t=Math.max(0,Math.floor(g.minLetterSpacing)),o=i.length<=1||(i.length-1)*t<=c-1;if(t>0&&o){const d=[];for(let a=0;a<i.length;a++){const y=i.length-a-1,k=a===0?0:d[d.length-1]+t,M=c-1-y*t;let A=k;M>k&&(A=k+Math.floor(Math.random()*(M-k+1))),A=Math.max(0,Math.min(c-1,A)),d.push(A)}const r=new Set;for(let a=0;a<e.length;a++){let y=d[a],k=0;for(;r.has(y)&&k<c;)y=Math.min(c-1,y+1),k++;if(r.has(y)){for(let A=0;A<c;A++)if(!r.has(A)){y=A;break}}r.add(y);const M=x[y];C.push({x:M.x,y:M.y,char:e[a],isWordLetter:!0})}for(let a=0;a<s.length;a++){let y=d[e.length+a],k=0;for(;r.has(y)&&k<c;)y=Math.min(c-1,y+1),k++;if(r.has(y)){for(let A=0;A<c;A++)if(!r.has(A)){y=A;break}}r.add(y);const M=x[y];C.push({x:M.x,y:M.y,char:s[a],isWordLetter:!1})}}else{const d=Math.max(1,Math.floor(c/(i.length+1))),r=new Set;for(let a=0;a<e.length;a++){const y=(a+1)*d,k=Math.floor((Math.random()-.5)*Math.max(1,Math.floor(d/2)));let M=Math.max(0,Math.min(c-1,y+k)),A=0;for(;r.has(M)&&A<c;)M=(M+1)%c,A++;r.add(M);const O=x[M];C.push({x:O.x,y:O.y,char:e[a],isWordLetter:!0})}for(let a=0;a<s.length;a++){const y=(e.length+a+1)*d,k=Math.floor((Math.random()-.5)*Math.max(1,Math.floor(d/2)));let M=Math.max(0,Math.min(c-1,y+k)),A=0;for(;r.has(M)&&A<c;)M=(M+1)%c,A++;r.add(M);const O=x[M];C.push({x:O.x,y:O.y,char:s[a],isWordLetter:!1})}}}else{F(h);for(let t=0;t<e.length&&t<h.length;t++)C.push({x:h[t].x,y:h[t].y,char:e[t],isWordLetter:!0});for(let t=0;t<s.length&&e.length+t<h.length;t++)C.push({x:h[e.length+t].x,y:h[e.length+t].y,char:s[t],isWordLetter:!1})}}function B(){const n=C.findIndex(s=>s.x===u.x&&s.y===u.y);if(n===-1)return;const l=C[n],e=S[L]||"",m=e[W.length];if(l.char.toLowerCase()===m.toLowerCase()){if(W+=l.char,C.splice(n,1),j(880,.08),D=!1,W.length>=e.length){N(),f&&f.showOverlay&&f.showOverlay("âœ”ï¸ Great! Next word","success"),L++,D=!0,f&&f.updateDisplays&&f.updateDisplays({word:S[L]||"",collected:"",hideWordText:D,attemptsLeft:z}),setTimeout(()=>{X()},1200);return}f&&f.updateDisplays&&f.updateDisplays({word:S[L]||"",collected:W,hideWordText:D,attemptsLeft:z})}else if(z--,j(220,.18),z<=0){_(),f&&f.showOverlay&&f.showOverlay("âœ–ï¸ Out of attempts â€” moving on","fail"),L++,D=!0,f&&f.updateDisplays&&f.updateDisplays({word:S[L]||"",collected:"",hideWordText:D,attemptsLeft:z}),setTimeout(()=>{X()},1400);return}else f&&f.showOverlay&&f.showOverlay("Try again","fail"),W="",U(S[L]||"")}function G(){P(),T&&(E=requestAnimationFrame(G))}function P(){if(!p)return;p.clearRect(0,0,v.width,v.height);const n=b[0]?b[0].length:g.baseCols*2+1,l=b.length||g.baseRows*2+1,e=Math.max(8,Math.min(g.cellSize,Math.floor((v.width-40)/n),Math.floor((v.height-40)/l))),m=n*e,s=l*e,i=Math.floor((v.width-m)/2),h=Math.floor((v.height-s)/2);for(let t=0;t<l;t++)for(let o=0;o<n;o++){const d=o*e+i,r=t*e+h;p.fillStyle=g.mazeColors.floor,p.fillRect(d,r,e-4,e-4),b[t]&&b[t][o]===1&&(p.fillStyle=g.mazeColors.wall,p.fillRect(d+6,r+6,e-16,e-16)),p.strokeStyle=g.mazeColors.border,p.strokeRect(d,r,e-4,e-4)}for(const t of C){const o=t.x*e+i,d=t.y*e+h;p.fillStyle="#333",p.font="bold 28px system-ui",p.textAlign="center",p.textBaseline="middle",p.fillText(t.char.toUpperCase(),o+(e-4)/2,d+(e-4)/2)}if(C.findIndex(t=>t.x===u.x&&t.y===u.y)!==-1){const t=u.x*e+i,o=u.y*e+h;p.strokeStyle="#ffb020",p.lineWidth=3,p.strokeRect(t+4,o+4,e-8,e-8),p.lineWidth=1,p.fillStyle="rgba(255,176,32,0.12)",p.fillRect(t+4,o+4,e-8,e-8),p.fillStyle="#222",p.font="13px system-ui",p.textAlign="center",p.fillText("Press Space to pick",t+(e-4)/2,o+e-6)}const x=u.x*e+i+(e-4)/2,c=u.y*e+h+(e-4)/2;g.playerAvatarUrl&&g.playerAvatarImage?p.drawImage(g.playerAvatarImage,x-40/2,c-40/2,40,40):(p.font="32px system-ui",p.textAlign="center",p.textBaseline="middle",p.fillText(g.playerAvatar||"ðŸ™‚",x,c))}function se(){T=!1,E&&cancelAnimationFrame(E),R&&window.removeEventListener("keydown",R),R=null,I&&v&&v.removeEventListener("click",I),I=null}const ie={init:le,startGame:oe,setWords:Z,setConfig:V,getState:$,retryWord:ee,hearWord:te,stop:se};export{ie as default,$ as getState,te as hearWord,le as init,ee as retryWord,V as setConfig,Z as setWords,oe as startGame,se as stop};
